<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ì˜ìƒ ì œì‘ ê³„íš ë° ìŠ¤í† ë¦¬ë³´ë“œ ìƒì„±ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans KR', sans-serif;
        }
        .form-label {
            @apply block text-sm font-medium text-gray-700 mb-1;
        }
        .form-input {
            @apply block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm;
        }
        .btn {
            @apply inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white focus:outline-none focus:ring-2 focus:ring-offset-2;
        }
        .btn-primary {
            @apply bg-indigo-600 hover:bg-indigo-700 focus:ring-indigo-500;
        }
        .btn-secondary {
            @apply bg-gray-600 hover:bg-gray-700 focus:ring-gray-500;
        }
        #loading-spinner {
            border-top-color: #4f46e5;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50">

    <div class="container mx-auto px-4 py-8 sm:py-12">
        <div class="max-w-4xl mx-auto">
            <div class="text-center mb-10">
                <h1 class="text-3xl sm:text-4xl font-bold text-gray-900">AI ì˜ìƒ ì œì‘ ê³„íš & ìŠ¤í† ë¦¬ë³´ë“œ ìƒì„±ê¸°</h1>
                <p class="mt-3 text-lg text-gray-600">ì•„ì´ë””ì–´ë¥¼ ì…ë ¥í•˜ê³  ì˜ìƒ ì œì‘ì˜ ì²« ë‹¨ê³„ë¥¼ ìë™í™”í•˜ì„¸ìš”.</p>
            </div>

            <!-- Input Form -->
            <div class="bg-white p-6 sm:p-8 rounded-xl shadow-lg">
                <form id="video-form" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="topic" class="form-label">ì˜ìƒ ì£¼ì œ</label>
                        <input type="text" id="topic" name="topic" class="form-input" placeholder="ì˜ˆ: ì¹œí™˜ê²½ ì»¤í”¼ ë¸Œëœë“œ ëŸ°ì¹­ í™ë³´" required>
                    </div>
                    <div>
                        <label for="target-audience" class="form-label">íƒ€ê²Ÿ ì‹œì²­ì</label>
                        <input type="text" id="target-audience" name="target-audience" class="form-input" placeholder="ì˜ˆ: 20-30ëŒ€ í™˜ê²½ì— ê´€ì‹¬ ë§ì€ ì§ì¥ì¸">
                    </div>
                    <div>
                        <label for="purpose" class="form-label">ì œì‘ ëª©ì </label>
                        <input type="text" id="purpose" name="purpose" class="form-input" placeholder="ì˜ˆ: ë¸Œëœë“œ ì¸ì§€ë„ ìƒìŠ¹ ë° ì´ˆê¸° ê³ ê° í™•ë³´">
                    </div>
                    <div>
                        <label for="mood" class="form-label">ì „ì²´ì ì¸ ë¶„ìœ„ê¸°</label>
                        <input type="text" id="mood" name="mood" class="form-input" placeholder="ì˜ˆ: ë”°ëœ»í•˜ê³ , ê°ì„±ì ì´ë©°, í¬ë§ì ì¸">
                    </div>
                    <div>
                        <label for="style" class="form-label">ì˜ìƒ ìŠ¤íƒ€ì¼</label>
                        <input type="text" id="style" name="style" class="form-input" placeholder="ì˜ˆ: ê°ì„±ì ì¸ ì¸í„°ë·°ì™€ ìì—° í’ê²½ ì»· êµì°¨ í¸ì§‘">
                    </div>
                    <div>
                        <label for="length" class="form-label">ì˜ìƒ ê¸¸ì´</label>
                        <input type="text" id="length" name="length" class="form-input" placeholder="ì˜ˆ: 1ë¶„ 30ì´ˆ">
                    </div>
                    <div class="md:col-span-2">
                        <label for="api-key" class="form-label">Google AI API í‚¤</label>
                        <input type="password" id="api-key" name="api-key" class="form-input" placeholder="API í‚¤ë¥¼ ì—¬ê¸°ì— ì…ë ¥í•˜ì„¸ìš”" required>
                        <p class="text-xs text-gray-500 mt-1">API í‚¤ëŠ” ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë˜ë©°, ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-indigo-600 hover:underline">API í‚¤ ë°œê¸‰ë°›ê¸°</a></p>
                    </div>

                    <div class="md:col-span-2 text-center mt-4">
                        <button type="submit" class="btn btn-primary w-full sm:w-auto">
                            ìƒì„±í•˜ê¸°
                        </button>
                    </div>
                </form>
            </div>

            <!-- Loading Indicator -->
            <div id="loading" class="text-center py-12 hidden">
                <div id="loading-spinner" class="w-12 h-12 rounded-full border-4 border-gray-200 border-t-indigo-600 animate-spin mx-auto"></div>
                <p class="mt-4 text-gray-700 font-medium">AIê°€ ì˜ìƒ ê³„íšì„ ìˆ˜ë¦½í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</p>
            </div>

            <!-- Error Message -->
            <div id="error-message" class="hidden mt-6 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg" role="alert">
                <strong class="font-bold">ì˜¤ë¥˜ ë°œìƒ:</strong>
                <span class="block sm:inline" id="error-text"></span>
            </div>
            
            <!-- Result Section -->
            <div id="result-container" class="mt-10 hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl sm:text-3xl font-bold text-gray-900">ìƒì„±ëœ ì´ˆì•ˆ</h2>
                    <button id="regenerate-btn" class="btn btn-secondary">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h5M20 20v-5h-5M4 4l1.5 1.5A9 9 0 0120.5 15M20 20l-1.5-1.5A9 9 0 003.5 9" />
                        </svg>
                        ë‹¤ì‹œ ìƒì„±í•˜ê¸°
                    </button>
                </div>

                <!-- Production Plan -->
                <div class="bg-white p-6 sm:p-8 rounded-xl shadow-lg mb-8">
                    <h3 class="text-xl font-bold text-gray-800 border-b pb-3 mb-4">ğŸ¬ ì˜ìƒ ì œì‘ ê³„íš</h3>
                    <div id="plan-output" class="space-y-4 text-gray-700"></div>
                </div>

                <!-- Storyboard -->
                <div class="bg-white p-6 sm:p-8 rounded-xl shadow-lg">
                    <h3 class="text-xl font-bold text-gray-800 border-b pb-3 mb-6">ğŸï¸ ìŠ¤í† ë¦¬ë³´ë“œ</h3>
                    <div id="storyboard-output" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Storyboard cards will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById('video-form');
        const loading = document.getElementById('loading');
        const resultContainer = document.getElementById('result-container');
        const planOutput = document.getElementById('plan-output');
        const storyboardOutput = document.getElementById('storyboard-output');
        const regenerateBtn = document.getElementById('regenerate-btn');
        const errorMessage = document.getElementById('error-message');
        const errorText = document.getElementById('error-text');

        let lastInputs = {};

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(form);
            const inputs = Object.fromEntries(formData.entries());
            lastInputs = inputs; // Save for regeneration
            generateContent(inputs);
        });

        regenerateBtn.addEventListener('click', () => {
            generateContent(lastInputs);
        });

        async function generateContent(inputs) {
            const apiKey = inputs['api-key'];
            if (!apiKey || !inputs.topic) {
                showError("API í‚¤ì™€ ì˜ìƒ ì£¼ì œë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return;
            }

            hideError();
            resultContainer.classList.add('hidden');
            loading.classList.remove('hidden');

            const systemPrompt = `ë‹¹ì‹ ì€ ì „ë¬¸ ì˜ìƒ ê°ë…ì´ì ìŠ¤í† ë¦¬ë³´ë“œ ì•„í‹°ìŠ¤íŠ¸ì…ë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì œê³µí•˜ëŠ” ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ, ì „ë¬¸ì ì´ê³  ì°½ì˜ì ì¸ ì˜ìƒ ì œì‘ ê³„íšê³¼ ìƒì„¸í•œ ìŠ¤í† ë¦¬ë³´ë“œë¥¼ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.

            ê²°ê³¼ëŠ” ë°˜ë“œì‹œ ë‹¤ìŒì˜ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•´ì•¼ í•©ë‹ˆë‹¤. ë‹¤ë¥¸ ì„¤ëª…ì´ë‚˜ í…ìŠ¤íŠ¸ë¥¼ ì¶”ê°€í•˜ì§€ ë§ˆì„¸ìš”.

            {
              "plan": {
                "title": "ì˜ìƒ ì œëª© ì œì•ˆ",
                "logline": "ì˜ìƒì„ í•œ ë¬¸ì¥ìœ¼ë¡œ ìš”ì•½í•œ ë¡œê·¸ë¼ì¸",
                "keyMessage": "ì˜ìƒì„ í†µí•´ ì „ë‹¬í•˜ê³ ì í•˜ëŠ” í•µì‹¬ ë©”ì‹œì§€",
                "targetAudienceAnalysis": "íƒ€ê²Ÿ ì‹œì²­ìì— ëŒ€í•œ ë¶„ì„ ë° ì˜ìƒì˜ ê¸°ëŒ€íš¨ê³¼",
                "moodAndTone": "ì˜ìƒì˜ ì „ë°˜ì ì¸ ë¶„ìœ„ê¸°ì™€ í†¤ì•¤ë§¤ë„ˆ",
                "styleConcept": "ì´¬ì˜, í¸ì§‘, ê·¸ë˜í”½ ë“± ì˜ìƒ ìŠ¤íƒ€ì¼ ì»¨ì…‰"
              },
              "storyboard": [
                {
                  "scene": "Scene #",
                  "timecode": "ì˜ˆ: 00:00-00:05",
                  "video": "í•´ë‹¹ ì”¬ì˜ êµ¬ì²´ì ì¸ ì˜ìƒ ë¬˜ì‚¬ (ì¹´ë©”ë¼ ì›Œí¬, êµ¬ë„, ë“±ì¥ì¸ë¬¼, ë°°ê²½ ë“±)",
                  "audio": "í•´ë‹¹ ì”¬ì˜ ë°°ê²½ìŒì•…, íš¨ê³¼ìŒ ë“±ì— ëŒ€í•œ ë¬˜ì‚¬",
                  "narration": "í•´ë‹¹ ì”¬ì˜ ë‚˜ë ˆì´ì…˜ ë˜ëŠ” ìë§‰ ë‚´ìš©"
                }
              ]
            }`;

            const userPrompt = `
            ë‹¤ìŒ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì˜ìƒ ì œì‘ ê³„íšê³¼ ìŠ¤í† ë¦¬ë³´ë“œë¥¼ JSON í˜•ì‹ìœ¼ë¡œ ìƒì„±í•´ì¤˜:
            - ì˜ìƒ ì£¼ì œ: ${inputs.topic}
            - íƒ€ê²Ÿ ì‹œì²­ì: ${inputs['target-audience']}
            - ì œì‘ ëª©ì : ${inputs.purpose}
            - ì „ì²´ì ì¸ ë¶„ìœ„ê¸°: ${inputs.mood}
            - ì˜ìƒ ìŠ¤íƒ€ì¼: ${inputs.style}
            - ì˜ìƒ ê¸¸ì´: ${inputs.length}
            `;
            
            const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        systemInstruction: { parts: [{ text: systemPrompt }] },
                        contents: [{ parts: [{ text: userPrompt }] }]
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    let customErrorMessage = errorData.error?.message || `API ìš”ì²­ ì‹¤íŒ¨ (HTTP ${response.status})`;
                    // Provide a more user-friendly error message for invalid API keys.
                    if (response.status === 400 && customErrorMessage.includes('API key not valid')) {
                        customErrorMessage = "ì…ë ¥í•˜ì‹  API í‚¤ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. Google AI Studioì—ì„œ ì˜¬ë°”ë¥¸ API í‚¤ë¥¼ ë°œê¸‰ë°›ì•„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
                    }
                    throw new Error(customErrorMessage);
                }

                const data = await response.json();
                const textContent = data.candidates?.[0]?.content?.parts?.[0]?.text;

                if (!textContent) {
                    throw new Error("API ì‘ë‹µì—ì„œ ì½˜í…ì¸ ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                }

                const cleanedText = textContent.replace(/```json/g, '').replace(/```/g, '').trim();
                const parsedResult = JSON.parse(cleanedText);
                
                displayResults(parsedResult);

            } catch (error) {
                console.error("Error:", error);
                showError(`ì½˜í…ì¸  ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
            } finally {
                loading.classList.add('hidden');
            }
        }
        
        function displayResults(result) {
            // Display Plan
            const plan = result.plan;
            planOutput.innerHTML = `
                <p><strong>ì˜ìƒ ì œëª©:</strong> ${plan.title}</p>
                <p><strong>ë¡œê·¸ë¼ì¸:</strong> ${plan.logline}</p>
                <p><strong>í•µì‹¬ ë©”ì‹œì§€:</strong> ${plan.keyMessage}</p>
                <p><strong>íƒ€ê²Ÿ ë¶„ì„:</strong> ${plan.targetAudienceAnalysis}</p>
                <p><strong>ë¶„ìœ„ê¸° ë° í†¤ì•¤ë§¤ë„ˆ:</strong> ${plan.moodAndTone}</p>
                <p><strong>ìŠ¤íƒ€ì¼ ì»¨ì…‰:</strong> ${plan.styleConcept}</p>
            `;
            
            // Display Storyboard
            const storyboard = result.storyboard;
            storyboardOutput.innerHTML = storyboard.map(scene => `
                <div class="border border-gray-200 rounded-lg p-4 bg-gray-50 flex flex-col h-full">
                    <div class="flex justify-between items-center mb-3">
                        <h4 class="font-bold text-indigo-700">${scene.scene}</h4>
                        <span class="text-xs font-mono bg-gray-200 text-gray-700 px-2 py-1 rounded">${scene.timecode}</span>
                    </div>
                    <div class="space-y-3 text-sm flex-grow">
                        <div>
                            <p class="font-semibold text-gray-800 mb-1">ğŸ¥ ì˜ìƒ (Video)</p>
                            <p class="text-gray-600">${scene.video}</p>
                        </div>
                        <div>
                            <p class="font-semibold text-gray-800 mb-1">ğŸ”Š ì˜¤ë””ì˜¤ (Audio)</p>
                            <p class="text-gray-600">${scene.audio}</p>
                        </div>
                        <div>
                            <p class="font-semibold text-gray-800 mb-1">ğŸ’¬ ë‚˜ë ˆì´ì…˜ / ìë§‰ (Narration)</p>
                            <p class="text-gray-600">${scene.narration}</p>
                        </div>
                    </div>
                </div>
            `).join('');

            resultContainer.classList.remove('hidden');
            resultContainer.scrollIntoView({ behavior: 'smooth' });
        }
        
        function showError(message) {
            errorText.textContent = message;
            errorMessage.classList.remove('hidden');
        }

        function hideError() {
            errorMessage.classList.add('hidden');
        }

    </script>
</body>
</html>

