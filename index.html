<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 영상 제작 계획 및 스토리보드 생성기</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans KR', sans-serif;
        }
        .form-label {
            @apply block text-sm font-medium text-gray-700 mb-1;
        }
        .form-input {
            @apply block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm;
        }
        .btn {
            @apply inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white focus:outline-none focus:ring-2 focus:ring-offset-2;
        }
        .btn-primary {
            @apply bg-indigo-600 hover:bg-indigo-700 focus:ring-indigo-500;
        }
        .btn-secondary {
            @apply bg-gray-600 hover:bg-gray-700 focus:ring-gray-500;
        }
        #loading-spinner {
            border-top-color: #4f46e5;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50">

    <div class="container mx-auto px-4 py-8 sm:py-12">
        <div class="max-w-4xl mx-auto">
            <div class="text-center mb-10">
                <h1 class="text-3xl sm:text-4xl font-bold text-gray-900">AI 영상 제작 계획 & 스토리보드 생성기</h1>
                <p class="mt-3 text-lg text-gray-600">아이디어를 입력하고 영상 제작의 첫 단계를 자동화하세요.</p>
            </div>

            <!-- Input Form -->
            <div class="bg-white p-6 sm:p-8 rounded-xl shadow-lg">
                <form id="video-form" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="topic" class="form-label">영상 주제</label>
                        <input type="text" id="topic" name="topic" class="form-input" placeholder="예: 친환경 커피 브랜드 런칭 홍보" required>
                    </div>
                    <div>
                        <label for="target-audience" class="form-label">타겟 시청자</label>
                        <input type="text" id="target-audience" name="target-audience" class="form-input" placeholder="예: 20-30대 환경에 관심 많은 직장인">
                    </div>
                    <div>
                        <label for="purpose" class="form-label">제작 목적</label>
                        <input type="text" id="purpose" name="purpose" class="form-input" placeholder="예: 브랜드 인지도 상승 및 초기 고객 확보">
                    </div>
                    <div>
                        <label for="mood" class="form-label">전체적인 분위기</label>
                        <input type="text" id="mood" name="mood" class="form-input" placeholder="예: 따뜻하고, 감성적이며, 희망적인">
                    </div>
                    <div>
                        <label for="style" class="form-label">영상 스타일</label>
                        <input type="text" id="style" name="style" class="form-input" placeholder="예: 감성적인 인터뷰와 자연 풍경 컷 교차 편집">
                    </div>
                    <div>
                        <label for="length" class="form-label">영상 길이</label>
                        <input type="text" id="length" name="length" class="form-input" placeholder="예: 1분 30초">
                    </div>
                    <div class="md:col-span-2">
                        <label for="api-key" class="form-label">Google AI API 키</label>
                        <input type="password" id="api-key" name="api-key" class="form-input" placeholder="API 키를 여기에 입력하세요" required>
                        <p class="text-xs text-gray-500 mt-1">API 키는 브라우저에만 저장되며, 서버로 전송되지 않습니다. <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-indigo-600 hover:underline">API 키 발급받기</a></p>
                    </div>

                    <div class="md:col-span-2 text-center mt-4">
                        <button type="submit" class="btn btn-primary w-full sm:w-auto">
                            생성하기
                        </button>
                    </div>
                </form>
            </div>

            <!-- Loading Indicator -->
            <div id="loading" class="text-center py-12 hidden">
                <div id="loading-spinner" class="w-12 h-12 rounded-full border-4 border-gray-200 border-t-indigo-600 animate-spin mx-auto"></div>
                <p class="mt-4 text-gray-700 font-medium">AI가 영상 계획을 수립하고 있습니다. 잠시만 기다려주세요...</p>
            </div>

            <!-- Error Message -->
            <div id="error-message" class="hidden mt-6 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg" role="alert">
                <strong class="font-bold">오류 발생:</strong>
                <span class="block sm:inline" id="error-text"></span>
            </div>
            
            <!-- Result Section -->
            <div id="result-container" class="mt-10 hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl sm:text-3xl font-bold text-gray-900">생성된 초안</h2>
                    <button id="regenerate-btn" class="btn btn-secondary">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h5M20 20v-5h-5M4 4l1.5 1.5A9 9 0 0120.5 15M20 20l-1.5-1.5A9 9 0 003.5 9" />
                        </svg>
                        다시 생성하기
                    </button>
                </div>

                <!-- Production Plan -->
                <div class="bg-white p-6 sm:p-8 rounded-xl shadow-lg mb-8">
                    <h3 class="text-xl font-bold text-gray-800 border-b pb-3 mb-4">🎬 영상 제작 계획</h3>
                    <div id="plan-output" class="space-y-4 text-gray-700"></div>
                </div>

                <!-- Storyboard -->
                <div class="bg-white p-6 sm:p-8 rounded-xl shadow-lg">
                    <h3 class="text-xl font-bold text-gray-800 border-b pb-3 mb-6">🎞️ 스토리보드</h3>
                    <div id="storyboard-output" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Storyboard cards will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById('video-form');
        const loading = document.getElementById('loading');
        const resultContainer = document.getElementById('result-container');
        const planOutput = document.getElementById('plan-output');
        const storyboardOutput = document.getElementById('storyboard-output');
        const regenerateBtn = document.getElementById('regenerate-btn');
        const errorMessage = document.getElementById('error-message');
        const errorText = document.getElementById('error-text');

        let lastInputs = {};

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(form);
            const inputs = Object.fromEntries(formData.entries());
            lastInputs = inputs; // Save for regeneration
            generateContent(inputs);
        });

        regenerateBtn.addEventListener('click', () => {
            generateContent(lastInputs);
        });

        async function generateContent(inputs) {
            const apiKey = inputs['api-key'];
            if (!apiKey || !inputs.topic) {
                showError("API 키와 영상 주제를 모두 입력해주세요.");
                return;
            }

            hideError();
            resultContainer.classList.add('hidden');
            loading.classList.remove('hidden');

            const systemPrompt = `당신은 전문 영상 감독이자 스토리보드 아티스트입니다. 사용자가 제공하는 정보를 바탕으로, 전문적이고 창의적인 영상 제작 계획과 상세한 스토리보드를 작성해야 합니다.

            결과는 반드시 다음의 JSON 형식으로만 응답해야 합니다. 다른 설명이나 텍스트를 추가하지 마세요.

            {
              "plan": {
                "title": "영상 제목 제안",
                "logline": "영상을 한 문장으로 요약한 로그라인",
                "keyMessage": "영상을 통해 전달하고자 하는 핵심 메시지",
                "targetAudienceAnalysis": "타겟 시청자에 대한 분석 및 영상의 기대효과",
                "moodAndTone": "영상의 전반적인 분위기와 톤앤매너",
                "styleConcept": "촬영, 편집, 그래픽 등 영상 스타일 컨셉"
              },
              "storyboard": [
                {
                  "scene": "Scene #",
                  "timecode": "예: 00:00-00:05",
                  "video": "해당 씬의 구체적인 영상 묘사 (카메라 워크, 구도, 등장인물, 배경 등)",
                  "audio": "해당 씬의 배경음악, 효과음 등에 대한 묘사",
                  "narration": "해당 씬의 나레이션 또는 자막 내용"
                }
              ]
            }`;

            const userPrompt = `
            다음 정보를 바탕으로 영상 제작 계획과 스토리보드를 JSON 형식으로 생성해줘:
            - 영상 주제: ${inputs.topic}
            - 타겟 시청자: ${inputs['target-audience']}
            - 제작 목적: ${inputs.purpose}
            - 전체적인 분위기: ${inputs.mood}
            - 영상 스타일: ${inputs.style}
            - 영상 길이: ${inputs.length}
            `;
            
            const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        systemInstruction: { parts: [{ text: systemPrompt }] },
                        contents: [{ parts: [{ text: userPrompt }] }]
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    let customErrorMessage = errorData.error?.message || `API 요청 실패 (HTTP ${response.status})`;
                    // Provide a more user-friendly error message for invalid API keys.
                    if (response.status === 400 && customErrorMessage.includes('API key not valid')) {
                        customErrorMessage = "입력하신 API 키가 유효하지 않습니다. Google AI Studio에서 올바른 API 키를 발급받아 다시 시도해주세요.";
                    }
                    throw new Error(customErrorMessage);
                }

                const data = await response.json();
                const textContent = data.candidates?.[0]?.content?.parts?.[0]?.text;

                if (!textContent) {
                    throw new Error("API 응답에서 콘텐츠를 찾을 수 없습니다.");
                }

                const cleanedText = textContent.replace(/```json/g, '').replace(/```/g, '').trim();
                const parsedResult = JSON.parse(cleanedText);
                
                displayResults(parsedResult);

            } catch (error) {
                console.error("Error:", error);
                showError(`콘텐츠 생성 중 오류가 발생했습니다: ${error.message}`);
            } finally {
                loading.classList.add('hidden');
            }
        }
        
        function displayResults(result) {
            // Display Plan
            const plan = result.plan;
            planOutput.innerHTML = `
                <p><strong>영상 제목:</strong> ${plan.title}</p>
                <p><strong>로그라인:</strong> ${plan.logline}</p>
                <p><strong>핵심 메시지:</strong> ${plan.keyMessage}</p>
                <p><strong>타겟 분석:</strong> ${plan.targetAudienceAnalysis}</p>
                <p><strong>분위기 및 톤앤매너:</strong> ${plan.moodAndTone}</p>
                <p><strong>스타일 컨셉:</strong> ${plan.styleConcept}</p>
            `;
            
            // Display Storyboard
            const storyboard = result.storyboard;
            storyboardOutput.innerHTML = storyboard.map(scene => `
                <div class="border border-gray-200 rounded-lg p-4 bg-gray-50 flex flex-col h-full">
                    <div class="flex justify-between items-center mb-3">
                        <h4 class="font-bold text-indigo-700">${scene.scene}</h4>
                        <span class="text-xs font-mono bg-gray-200 text-gray-700 px-2 py-1 rounded">${scene.timecode}</span>
                    </div>
                    <div class="space-y-3 text-sm flex-grow">
                        <div>
                            <p class="font-semibold text-gray-800 mb-1">🎥 영상 (Video)</p>
                            <p class="text-gray-600">${scene.video}</p>
                        </div>
                        <div>
                            <p class="font-semibold text-gray-800 mb-1">🔊 오디오 (Audio)</p>
                            <p class="text-gray-600">${scene.audio}</p>
                        </div>
                        <div>
                            <p class="font-semibold text-gray-800 mb-1">💬 나레이션 / 자막 (Narration)</p>
                            <p class="text-gray-600">${scene.narration}</p>
                        </div>
                    </div>
                </div>
            `).join('');

            resultContainer.classList.remove('hidden');
            resultContainer.scrollIntoView({ behavior: 'smooth' });
        }
        
        function showError(message) {
            errorText.textContent = message;
            errorMessage.classList.remove('hidden');
        }

        function hideError() {
            errorMessage.classList.add('hidden');
        }

    </script>
</body>
</html>

